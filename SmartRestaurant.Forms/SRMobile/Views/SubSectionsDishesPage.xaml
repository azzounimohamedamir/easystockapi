<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:d="http://xamarin.com/schemas/2014/forms/design" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:ffimageloading="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms" xmlns:fftransformations="clr-namespace:FFImageLoading.Transformations;assembly=FFImageLoading.Transformations" xmlns:ia="clr-namespace:IntelliAbb.Xamarin.Controls;assembly=IntelliAbb.Xamarin.Controls" xmlns:translator="clr-namespace:SmartRestaurant.Diner.Helpers" xmlns:vms="clr-namespace:SmartRestaurant.Diner.ViewModels.Sections" xmlns:controls="clr-namespace:SmartRestaurant.Diner.CustomControls" xmlns:flv="clr-namespace:DLToolkit.Forms.Controls;assembly=DLToolkit.Forms.Controls.FlowListView" xmlns:effects="clr-namespace:SmartRestaurant.Diner.CustomEffects" xmlns:lc="clr-namespace:XLabs.Forms.Controls;assembly=XLabs.Forms" xmlns:lb="clr-namespace:XLabs.Forms.Behaviors;assembly=XLabs.Forms" xmlns:multigestureviewplugin="clr-namespace:MultiGestureViewPlugin;assembly=MultiGestureViewPlugin" xmlns:pancakeview="clr-namespace:Xamarin.Forms.PancakeView;assembly=Xamarin.Forms.PancakeView" mc:Ignorable="d" NavigationPage.HasBackButton="True" FlowDirection="{Binding FlowDirectionValue}" x:Class="SmartRestaurant.Diner.Views.SubSectionsDishesPage" Title="{translator:Translate RestaurantName}" x:Name="instance" BackgroundColor="White">
    <ContentPage.Resources>
        <translator:NegateBooleanConverter x:Key="inverter" />
    </ContentPage.Resources>
    <ContentPage.Content>
        <StackLayout FlowDirection="MatchParent" Orientation="Vertical">
            <pancakeview:PancakeView VerticalOptions="Start" BackgroundColor="White" HorizontalOptions="FillAndExpand" HeightRequest="196" BorderDrawingStyle="Outside" IsClippedToBounds="True" CornerRadius="0" HasShadow="true" Elevation="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="140" />
                        <RowDefinition Height="56" />
                    </Grid.RowDefinitions>
                    <Image HeightRequest="140" Grid.Row="0" Source="{Binding Section.Image}" HorizontalOptions="FillAndExpand" VerticalOptions="StartAndExpand" Aspect="AspectFill" />
                    <Label Grid.Row="1" BackgroundColor="White" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" HeightRequest="56" HorizontalOptions="FillAndExpand" Text="{Binding Section.Name}" TextColor="#01A9AC" FontSize="24" FontFamily="Assets/Fonts/Roboto.ttf" FontAttributes="Bold" VerticalOptions="End"></Label>
                </Grid>
            </pancakeview:PancakeView>
            <ListView VerticalOptions="FillAndExpand" VerticalScrollBarVisibility="Default" FlowDirection="MatchParent" ItemsSource="{Binding SubSections}" HasUnevenRows="true" SeparatorVisibility="Default" SeparatorColor="#1A000000" SelectionMode="Single" SelectedItem="{Binding Path=SelectedSubSection}" ItemTapped="Handle_ItemTapped" Footer="">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <Grid RowSpacing="0" FlowDirection="MatchParent">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="56" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <StackLayout x:Name="currentsubsection" BackgroundColor="#FBFBFB" FlowDirection="MatchParent" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                                    <StackLayout Grid.Row="0" FlowDirection="MatchParent" Margin="48,0,48,0" Orientation="Horizontal" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                                        <Label FontSize="20" HeightRequest="56" HorizontalOptions="StartAndExpand" VerticalOptions="CenterAndExpand" HorizontalTextAlignment="Start" TextColor="#3C536A" FontFamily="Assets/Fonts/Roboto.ttf" VerticalTextAlignment="Center">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Name}" />
                                                    <Span Text="{Binding Dishes.Dishes.Count,StringFormat=' ({0})'}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                        <Label Visual="Material" Text="&#xf140;" FontFamily="Fonts/materialdesignicons-webfont.ttf#Material Design Icons" HorizontalTextAlignment="End" VerticalTextAlignment="Center" TextColor="Black" FontSize="26" />
                                    </StackLayout>
                                </StackLayout>
                                <ListView FlowDirection="MatchParent" Grid.Row="1" IsVisible="{Binding IsVisible}" Margin="36,5,36,5" VerticalScrollBarVisibility="Default" SeparatorVisibility="None" HasUnevenRows="false" RowHeight="112" VerticalOptions="CenterAndExpand" SelectionMode="None" ItemsSource="{Binding Dishes.Dishes}">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <ViewCell>
                                                <pancakeview:PancakeView FlowDirection="MatchParent" Margin="12,5,12,5" VerticalOptions="Start" BorderColor="#4D707070" BackgroundColor="White" HorizontalOptions="FillAndExpand" HeightRequest="102" IsClippedToBounds="True" CornerRadius="10" BorderThickness="1" HasShadow="False" Elevation="0">
                                                    <pancakeview:PancakeView.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding ShowDishCommand}" CommandParameter="{Binding Path=BindingContext, Source={x:Reference currentsubsection}}" />
                                                    </pancakeview:PancakeView.GestureRecognizers>
                                                    <StackLayout FlowDirection="MatchParent" HeightRequest="102" VerticalOptions="Start" Orientation="Horizontal">
                                                        <pancakeview:PancakeView Padding="12" VerticalOptions="Start" BorderColor="Transparent" BackgroundColor="Transparent" HorizontalOptions="Start" HeightRequest="78" WidthRequest="78" IsClippedToBounds="True" CornerRadius="10" HasShadow="False" Elevation="0">
                                                            <Image Source="{Binding Images[0]}" Aspect="AspectFill" />
                                                        </pancakeview:PancakeView>
                                                        <StackLayout Margin="48,12,48,12" Orientation="Vertical" HorizontalOptions="StartAndExpand">
                                                            <Label FontSize="14" TextColor="Black" Text="{Binding Name, Mode=TwoWay}" FontAttributes="Bold" VerticalTextAlignment="Start" HorizontalTextAlignment="Start" HorizontalOptions="StartAndExpand" VerticalOptions="Start" FontFamily="Assets/Fonts/Roboto.ttf" />
                                                            <Label FontSize="12" TextColor="Black" VerticalTextAlignment="Start" HorizontalTextAlignment="Start" HorizontalOptions="StartAndExpand" VerticalOptions="StartAndExpand" FontFamily="Assets/Fonts/Roboto.ttf">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span Text="{translator:Translate EstimatedTime}" />
                                                                        <Span Text=" : " />
                                                                        <Span Text="{Binding EstimatedTime, Mode=TwoWay}" />
                                                                        <Span Text=" " />
                                                                        <Span Text="{translator:Translate minute}" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                            <Label FontSize="12" TextColor="#02A9AC" FontAttributes="Bold" VerticalTextAlignment="End" HorizontalOptions="Start" VerticalOptions="End" FontFamily="Assets/Fonts/Roboto.ttf">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span Text="{Binding Price, Mode=TwoWay}" />
                                                                        <Span Text=" " />
                                                                        <Span Text="{translator:Translate Currency_DZ}" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                        </StackLayout>
                                                        <Label Margin="12" TextColor="#01A9AC" Text="&#xf419;" FontFamily="Fonts/materialdesignicons-webfont.ttf#Material Design Icons" IsVisible="{Binding IsSelected,Converter={StaticResource inverter},Mode=TwoWay}" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" HorizontalOptions="End" VerticalOptions="Center" FontSize="28">
                                                            <Label.GestureRecognizers>
                                                                <TapGestureRecognizer Tapped="TapGestureRecognizer_Tapped" />
                                                            </Label.GestureRecognizers>
                                                        </Label>
                                                        <Label Margin="12" TextColor="#01A9AC" Text="&#xf133;" FontFamily="Fonts/materialdesignicons-webfont.ttf#Material Design Icons" IsVisible="{Binding IsSelected,Mode=TwoWay }" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" HorizontalOptions="End" VerticalOptions="Center" FontSize="28">
                                                            <Label.GestureRecognizers>
                                                                <TapGestureRecognizer Tapped="TapGestureRecognizer_Tapped" />
                                                            </Label.GestureRecognizers>
                                                        </Label>
                                                    </StackLayout>
                                                </pancakeview:PancakeView>
                                            </ViewCell>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Grid>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView >
            <pancakeview:PancakeView VerticalOptions="EndAndExpand" Margin="0" FlowDirection="LeftToRight" BackgroundColor="White" HorizontalOptions="FillAndExpand" HeightRequest="88" BorderDrawingStyle="Inside" IsClippedToBounds="True" CornerRadius="20,20,0,0" HasShadow="true" Elevation="6">
                <Grid VerticalOptions="Center" Margin="0,0,38,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="32" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="32" />
                        <RowDefinition Height="1*" />
                    </Grid.RowDefinitions>
                    <Button Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="0" Grid.RowSpan="2" CornerRadius="28" HeightRequest="60" HorizontalOptions="EndAndExpand" VerticalOptions="Center" WidthRequest="174" BackgroundColor="#01A9AC" FontSize="14" FontFamily="Assets/Fonts/Roboto.ttf" FontAttributes="Bold" ImageSource="food.png" TextColor="White" Text="{translator:Translate Order}" />
                    <Button Grid.Row="0" HeightRequest="32" WidthRequest="32" Margin="8,-8,-8,-8" CornerRadius="16" Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Start" FontAttributes="Bold" BackgroundColor="White" FontSize="12" FontFamily="Assets/Fonts/Roboto.ttf" Text="{Binding SelectedDishes.Count, Source={x:Static vms:SectionsListViewModel.Instance},Mode=TwoWay}"></Button>
                    <Label Grid.Row="0" Grid.Column="0" Grid.RowSpan="2" BackgroundColor="Transparent" HorizontalTextAlignment="{Binding OrientationText}" VerticalTextAlignment="Start" HorizontalOptions="Start" Margin="38,0,0,0" VerticalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="{translator:Translate price}" TextColor="#77000000" FontSize="14" FontFamily="Assets/Fonts/Roboto.ttf" FontAttributes="Bold" />
                                <Span Text="&#10;" TextColor="#01A9AC" FontAttributes="Bold" FontSize="24" FontFamily="Assets/Fonts/Roboto.ttf" />
                                <Span Text="{Binding TotalPrice, Source={x:Static vms:SectionsListViewModel.Instance},Mode=TwoWay}" TextColor="#01A9AC" FontAttributes="Bold" FontSize="24" FontFamily="Assets/Fonts/Roboto.ttf" />
                                <Span Text="{translator:Translate Currency_DZ}" TextColor="#01A9AC" FontAttributes="Bold" FontSize="24" FontFamily="Assets/Fonts/Roboto.ttf" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </Grid>
            </pancakeview:PancakeView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>